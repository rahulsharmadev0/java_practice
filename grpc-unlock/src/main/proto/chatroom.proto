syntax = "proto3";

package chatroom;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option java_multiple_files = true;
option java_package = "com.example.chatroom";
option java_outer_classname = "ChatRoomProto";

// ChatRoomService is minimal gRPC service for managing chat rooms and messages.
// It supports joining/leaving rooms and sending messages.
// User are identified by their remote address in this simple example.
service ChatRoomService {

    // JoinRoom allows a user to join the chat room.
  rpc JoinRoom(JoinRequest) returns (stream ChatMessage);

    // LeaveRoom allows a user to leave the chat room.
  rpc LeaveRoom(LeaveRequest) returns (google.protobuf.Empty);

    // SendMessage allows a user to send a message to the chat room.
  rpc SendMessage(stream ChatMessage) returns (stream SendMessageResponse);

}

enum MessageStatus {

  UNSPECIFIED = 0;
  SENT        = 1;
  FAILED      = 2;

}

// ========================
// Request / Response
// ========================

message JoinRequest {
  string room_id = 1;
}

message LeaveRequest {
  string room_id = 1;
}

message ChatMessage {
  string                    message_id = 1;
  string                    room_id    = 2;
  string                    content    = 3;
  MessageStatus             status     = 4;
  google.protobuf.Timestamp timestamp  = 5;
}

message SendMessageResponse {
  string        message_id = 1;
  MessageStatus status     = 2;
}